<!--/*@thymesVar id="notificationEndpoints" type="java.util.List<io.eyecu.passhelper.models.NotificationEndpointView>"*/-->
<!--/*@thymesVar id="addNotificationEndpointForm" type="io.eyecu.passhelper.models.AddNotificationEndpointForm"*/-->

<!DOCTYPE html>
<html lang="en" data-bs-theme="light" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PassHelper</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" crossorigin="anonymous"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <link rel="stylesheet" crossorigin="anonymous"
          href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css">

    <th:block th:replace="~{fragments/favicon.html}"></th:block>
</head>
<body>
<main>
    <th:block th:replace="~{fragments/header.html :: header(${ {'Notification Email Address'} })}"></th:block>
    <div class="container mb-3">
        <div class="card shadow-sm">
            <div class="card-body bg-light-subtle">
                <p class="card-subtitle text-body-secondary mb-3 border-bottom">Passport expiration reminder emails will be sent to all email addresses listed
                    below.</p>
                <th:block th:each="notificationEndpoint : ${notificationEndpoints}">
                    <div class="row mb-3">
                        <div class="col-10">
                            <span th:text="${notificationEndpoint.email}">a@b.com</span>
                        </div>
                        <div class="col-2">
                            <a th:email-id="${notificationEndpoint.id}" href="#" onclick="deleteEmail(this.getAttribute('email-id'))"
                               class="float-end pe-3 text-danger text-decoration-none">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                    </div>
                </th:block>
                <form method="post" th:action="@{notification-endpoints}" enctype="application/x-www-form-urlencoded" th:object="${addNotificationEndpointForm}">
                    <div class="row">
                        <div class="col-10">
                            <input type="email" class="form-control" placeholder="Add a new email address" id="email" name="email"
                                   aria-label="Add a new email address" th:required="required" th:value="*{email}" required>
                        </div>
                        <div class="col-2">
                            <button type="submit" class="float-end btn btn-primary">Add</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>
<th:block th:replace="~{fragments/footer.html :: footer}"></th:block>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

<script th:inline="javascript">

    function deleteEmail(email) {
        let result = window.confirm("Are you sure you want to delete this email address?")
        if (result) {
            let request = new XMLHttpRequest()
            request.open("DELETE", "/notification-endpoints/" + email)
            request.onreadystatechange = () => {
                if (request.readyState === 4) {
                    document.location = "/notification-endpoints"
                }
            }
            request.send()
        }
    }

</script>
<th:block th:replace="~{fragments/color_mode.html}"></th:block>
</body>
</html>